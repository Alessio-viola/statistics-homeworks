<!DOCTYPE html>
<html>
<head>
  <title>Simulazione Tracciamento Sicurezza</title>
  <style>
    #securityChart {
      border: 1px solid #000;
    }
  </style>

</head>
<body>
  <h1>Simulazione Tracciamento Sicurezza</h1>
  <p>Inserisci i valori:</p>
  <label for="numSystems">Numero di sistemi (N):</label>
  <input type="number" id="numSystems" value="5"><br>
  <label for="numAttacks">Numero di attacchi (M):</label>
  <input type="number" id="numAttacks" value="10"><br>
  <label for "attackProbability">Probabilit√† di successo di un attacco (p):</label>
  <input type="number" step="0.01" id="attackProbability" value="0.5"><br>
  <button onclick="simulateSecurityTrajectories()">Simula</button>
  <div id="canvas-container">
    <canvas id="securityChart" width="500" height="400"></canvas>
  </div>
  </body>

  <script>
    var canvas = document.getElementById("securityChart");
    var ctx = canvas.getContext("2d");
    const canvasContainer = document.getElementById("canvas-container");

    // Crea un'immagine temporanea del canvas per il ripristino
    const tempCanvas = document.createElement("canvas");
    const tempCtx = tempCanvas.getContext("2d");


    function simulateSecurityTrajectories() {
      var N = parseInt(document.getElementById("numSystems").value);
      var M = parseInt(document.getElementById("numAttacks").value);
      var p = parseFloat(document.getElementById("attackProbability").value);

      canvas.width = 500 + M * 20; // Regola la larghezza del canvas in base al numero di attacchi
      canvas.height = 400;
      //ctx.clearRect(0, 0, canvas.width, canvas.height);

      var colors = ["#ff5733", "#33ff57", "#3366ff", "#ff3366", "#66ff33"]; // Colori per i sistemi

      var centerX = 40;
      var centerY = canvas.height / 2;

      // Disegna l'asse X (attacchi)
      ctx.beginPath();
      ctx.moveTo(centerX, canvas.height - 20);
      ctx.lineTo(canvas.width - 20, canvas.height - 20);
      ctx.stroke();

      // Disegna l'asse Y (punteggio)
      ctx.beginPath();
      ctx.moveTo(centerX, canvas.height - 20);
      ctx.lineTo(centerX, 20);
      ctx.stroke();

      // Etichette per l'asse X
      ctx.fillStyle = "#000";
      for (var i = 0; i < M; i++) {
        var x = centerX + (i / M) * (canvas.width - 60);
        ctx.fillText((i + 1).toString(), x, canvas.height - 5);
      }

      // Etichette per l'asse Y
      ctx.textAlign = "right";
      for (var i = -20; i <= 20; i++) {
        var y = centerY - ((i / 40) * (canvas.height - 40));
        ctx.fillText(i.toString(), centerX - 5, y);
      }

      for (var i = 0; i < N; i++) {
        var score = 0;
        var trajectory = [];
        ctx.beginPath();
        ctx.strokeStyle = colors[i];
        ctx.lineWidth = 2;

        for (var j = 0; j < M; j++) {
          var outcome = Math.random() < p ? 1 : -1;
          score += outcome;
          var x = centerX + (j / M) * (canvas.width - 60);
          var y = centerY - ((score / 40) * (canvas.height - 40));
          trajectory.push({ x, y });
        }

        for (var j = 0; j < trajectory.length; j++) {
          if (j === 0) {
            ctx.moveTo(trajectory[j].x, trajectory[j].y);
          } else {
            ctx.lineTo(trajectory[j].x, trajectory[j].y);
          }
        }

        ctx.stroke();
      }
    }

    let isResizing = false;
    let initialX;
    let initialY;
    let originalWidth;
    let originalHeight;

    canvas.addEventListener("mousedown", (e) => {
      if (e.offsetX > canvas.width - 10 && e.offsetY > canvas.height - 10) {
        isResizing = true;
        initialX = e.clientX;
        initialY = e.clientY;
        originalWidth = canvas.width;
        originalHeight = canvas.height;
      }
    });

    window.addEventListener("mousemove", (e) => {
  if (!isResizing) return;

  const newWidth = originalWidth + e.clientX - initialX;
  const newHeight = originalHeight + e.clientY - initialY;

  // Salva il contenuto del canvas
  const image = canvas.toDataURL();

  // Imposta le nuove dimensioni del canvas
  canvas.width = newWidth;
  canvas.height = newHeight;

  // Ripristina il contenuto salvato
  const img = new Image();
  img.onload = function () {
    ctx.drawImage(img, 0, 0);
  };
  img.width = canvas.width
  img.height = canvas.height
  img.src = image;
});

    window.addEventListener("mouseup", () => {
      isResizing = false;
    });

    window.addEventListener("resize", () => {
      canvas.width = canvasContainer.clientWidth;
      canvas.height = canvasContainer.clientHeight;
    });

    // Inizializza le dimensioni del canvas
    canvas.width = canvasContainer.clientWidth;
    canvas.height = canvasContainer.clientHeight;
  </script>

</html>
